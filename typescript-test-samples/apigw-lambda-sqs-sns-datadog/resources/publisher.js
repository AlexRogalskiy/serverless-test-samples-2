"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const client_sns_1 = require("@aws-sdk/client-sns");
const axios_1 = require("axios");
const delay_1 = require("./delay");
const snsClient = new client_sns_1.SNSClient({ region: process.env.AWS_REGION });
const topicArn = process.env.SNS_TOPIC_ARN;
exports.main = async function (event) {
    if (event.body) {
        for (let i = 0; i < 3; i++) {
            await axios_1.default.get('https://datadoghq.com');
            await (0, delay_1.default)(15);
        }
        const command = new client_sns_1.PublishCommand({
            TopicArn: topicArn,
            Message: event.body
        });
        await snsClient.send(command);
        console.log('published a message to SNS');
        const response = {
            statusCode: 200,
            body: JSON.stringify({
                status: 'pushed'
            })
        };
        return response;
    }
    const response = {
        statusCode: 422,
        body: JSON.stringify({
            status: 'Body required'
        })
    };
    return response;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVibGlzaGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHVibGlzaGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQStEO0FBRS9ELGlDQUEwQjtBQUMxQixtQ0FBNEI7QUFDNUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxzQkFBUyxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQTtBQUNuRSxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQTtBQUUxQyxPQUFPLENBQUMsSUFBSSxHQUFHLEtBQUssV0FBVSxLQUEyQjtJQUN2RCxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUU7UUFFZCxLQUFLLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3hCLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFBO1lBQ3hDLE1BQU0sSUFBQSxlQUFLLEVBQUMsRUFBRSxDQUFDLENBQUE7U0FDaEI7UUFDRCxNQUFNLE9BQU8sR0FBRyxJQUFJLDJCQUFjLENBQUM7WUFDakMsUUFBUSxFQUFFLFFBQVE7WUFDbEIsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJO1NBQ3BCLENBQUMsQ0FBQTtRQUNGLE1BQU0sU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUE7UUFDekMsTUFBTSxRQUFRLEdBQTBCO1lBQ3RDLFVBQVUsRUFBRSxHQUFHO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2FBQ2pCLENBQUM7U0FDSCxDQUFBO1FBQ0QsT0FBTyxRQUFRLENBQUE7S0FDaEI7SUFDRCxNQUFNLFFBQVEsR0FBMEI7UUFDdEMsVUFBVSxFQUFFLEdBQUc7UUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUNuQixNQUFNLEVBQUUsZUFBZTtTQUN4QixDQUFDO0tBQ0gsQ0FBQTtJQUNELE9BQU8sUUFBUSxDQUFBO0FBQ2pCLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNOU0NsaWVudCwgUHVibGlzaENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc25zJ1xuaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnQsIEFQSUdhdGV3YXlQcm94eVJlc3VsdCB9IGZyb20gXCJhd3MtbGFtYmRhXCI7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IGRlbGF5IGZyb20gJy4vZGVsYXknO1xuY29uc3Qgc25zQ2xpZW50ID0gbmV3IFNOU0NsaWVudCh7IHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB9KVxuY29uc3QgdG9waWNBcm4gPSBwcm9jZXNzLmVudi5TTlNfVE9QSUNfQVJOXG5cbmV4cG9ydHMubWFpbiA9IGFzeW5jIGZ1bmN0aW9uKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCk6IFByb21pc2U8QVBJR2F0ZXdheVByb3h5UmVzdWx0PiB7XG4gIGlmIChldmVudC5ib2R5KSB7XG5cbiAgICBmb3IgKGxldCBpPTA7IGkgPCAzOyBpKyspIHtcbiAgICAgIGF3YWl0IGF4aW9zLmdldCgnaHR0cHM6Ly9kYXRhZG9naHEuY29tJylcbiAgICAgIGF3YWl0IGRlbGF5KDE1KVxuICAgIH1cbiAgICBjb25zdCBjb21tYW5kID0gbmV3IFB1Ymxpc2hDb21tYW5kKHtcbiAgICAgIFRvcGljQXJuOiB0b3BpY0FybixcbiAgICAgIE1lc3NhZ2U6IGV2ZW50LmJvZHlcbiAgICB9KVxuICAgIGF3YWl0IHNuc0NsaWVudC5zZW5kKGNvbW1hbmQpXG4gICAgY29uc29sZS5sb2coJ3B1Ymxpc2hlZCBhIG1lc3NhZ2UgdG8gU05TJylcbiAgICBjb25zdCByZXNwb25zZTogQVBJR2F0ZXdheVByb3h5UmVzdWx0ID0ge1xuICAgICAgc3RhdHVzQ29kZTogMjAwLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBzdGF0dXM6ICdwdXNoZWQnXG4gICAgICB9KVxuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2VcbiAgfVxuICBjb25zdCByZXNwb25zZTogQVBJR2F0ZXdheVByb3h5UmVzdWx0ID0ge1xuICAgIHN0YXR1c0NvZGU6IDQyMixcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBzdGF0dXM6ICdCb2R5IHJlcXVpcmVkJ1xuICAgIH0pXG4gIH1cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbiJdfQ==